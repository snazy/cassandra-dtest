language: python
cache: pip
python:
  - "2.7"
install:
  - export CASS_DRIVER_NO_EXTENSIONS=true
  - export CASS_DRIVER_NO_CYTHON=true
  - pip install --upgrade flake8 pylint
  - pip install --upgrade -r requirements.txt
script:
  # we want pyflakes to check all files for unused imports only
  # we use flake8 because it allows us to ignore other warnings
  # exclude the thrift directories - they contain auto-generated code
  - flake8 --ignore=E501,F811,F812,F822,F823,F831,F841,N8,C9 --exclude=thrift_bindings,cassandra-thrift dtests/ tools/ cqlsh_tests/ meta_tests/ repair_tests/ upgrade_tests/ thrift_tests/
  - git remote add riptano git@github.com:riptano/apollo-dtest.git
  - git fetch riptano # fetch master for the next diff
  # feed changed lines with no context around them to pycodestyle
  # I know we don't enforce line length but if you introduce
  # 200-char lines you are doing something terribly wrong.
  # lint all files for everything but line length errors
  - git diff riptano/master...HEAD -U0 | pycodestyle --ignore=E501 --diff
  # lint all files except json_test.py for line length errors
  - git diff riptano/master...HEAD -U0 | pycodestyle --diff --exclude='json_test.py' --exclude='meta_tests/assertion_test.py' --max-line-length=200
  - pylint dtests/ tools/ cqlsh_tests/ meta_tests/ repair_tests/ thrift_tests/
sudo: false
